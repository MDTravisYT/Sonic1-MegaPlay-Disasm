VBLANK:
		MOVEM.L	D0-D7/A0-A6,	-(SP)
		JSR		(SUB_68A).L
		TST.B	(V_VBLA_ROUTINE).W
		BEQ.S	VBLA_00
		MOVE.L	#$40000010,	($C00004).L
		MOVE.L	(V_SCRPOSY_VDP).W,	($C00000).L
		BTST	#6,	(V_MEGADRIVE).W
		BEQ.S	VB_NOTPAL
		MOVE.W	#$700,	D0
		
	VB_WAITPAL:
		DBF		D0,	VB_WAITPAL
		
	VB_NOTPAL:
		MOVE.B	(V_VBLA_ROUTINE).W,	D0
		MOVE.B	#0,	(V_VBLA_ROUTINE).W
		MOVE.W	#1,	(F_HBLA_PAL).W
		ANDI.W	#$3E,	D0
		MOVE.W	VBLA_INDEX(PC,	D0.W),	D0
		JSR		VBLA_INDEX(PC,	D0.W)
		
	VBLA_MUSIC:
		JSR		UPDATEMUSIC
		
	VBLA_EXIT:
		ADDQ.L	#1,	(V_VBLA_COUNT).W
		BSR.W	SUB_81E
		MOVEM.L	(SP)+,	D0-D7/A0-A6
		RTE

VBLA_INDEX:
		DC.W	VBLA_00-VBLA_INDEX
		DC.W	VBLA_02-VBLA_INDEX
		DC.W	VBLA_04-VBLA_INDEX
		DC.W	VBLA_06-VBLA_INDEX
		DC.W	VBLA_08-VBLA_INDEX
		DC.W	VBLA_0A-VBLA_INDEX
		DC.W	VBLA_0C-VBLA_INDEX
		DC.W	VBLA_0E-VBLA_INDEX
		DC.W	VBLA_08-VBLA_INDEX
		DC.W	VBLA_12-VBLA_INDEX
		DC.W	VBLA_14-VBLA_INDEX
		DC.W	VBLA_16-VBLA_INDEX
		DC.W	VBLA_0C-VBLA_INDEX
		DC.W	VBLA_1A-VBLA_INDEX
		
VBLA_00:	
		CMPI.B	#$8C,	(V_GAMEMODE).W
		BEQ.S	VB00_ISLEVEL
		CMPI.B	#$C,	(V_GAMEMODE).W
		BNE.W	VBLA_MUSIC
		
	VB00_ISLEVEL:
		CMPI.B	#1,	(V_ZONE).W
		BNE.W	VBLA_MUSIC
		MOVE.W	($C00004).L,	D0
		BTST	#6,	(V_MEGADRIVE).W
		BEQ.S	VB00_NOTPAL
		MOVE.W	#$700,	D0
		
	VB00_WAITPAL:
		DBF	D0,	VB00_WAITPAL
		
	VB00_NOTPAL:
		MOVE.W	#1,	(F_HBLA_PAL).W
		TST.B	(F_WTR_STATE).W
		BNE.S	VB00_WATERABOVE
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9580,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		BRA.S	VB00_WATERBELOW
		
	VB00_WATERABOVE:
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9540,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		
	VB00_WATERBELOW:
		MOVE.W	(V_HBLA_HREG).W,	(A5)
		BRA.W	VBLA_MUSIC
		
	
VBLA_02:	
		BSR.W	SUB_12A8
		
VBLA_14:	
		TST.W	(V_DEMOLENGTH).W
		BEQ.W	VB14_END
		SUBQ.W	#1,	(V_DEMOLENGTH).W

	VB14_END:
		RTS

VBLA_04:	
		BSR.W	SUB_12A8
		BSR.W	LOADTILESASYOUMOVE_BGONLY
		BSR.W	SUB_1862
		TST.W	(V_DEMOLENGTH).W
		BEQ.W	VB04_END
		SUBQ.W	#1,	(V_DEMOLENGTH).W
		
	VB04_END:
		RTS

VBLA_06:	
		BSR.W	SUB_12A8
		RTS

VBLA_08:	
		BSR.W	READJOYPADS
		TST.B	(F_WTR_STATE).W
		BNE.S	VB08_WATERABOVE
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9580,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		BRA.S	VB08_WATERBELOW
	
	VB08_WATERABOVE:
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9540,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		
	VB08_WATERBELOW:
		MOVE.W	(V_HBLA_HREG).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$940193C0,	(A5)
		MOVE.L	#$96E69500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7C00,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$94019340,	(A5)
		MOVE.L	#$96FC9500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7800,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		TST.B	(F_SONFRAMECHG).W
		BEQ.S	VB08_NOCHG
		LEA		($C00004).L,	A5
		MOVE.L	#$94019370,	(A5)
		MOVE.L	#$96E49500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7000,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		MOVE.B	#0,	(F_SONFRAMECHG).W
		
	VB08_NOCHG:
		MOVEM.L	(V_SCREENPOSX).W,	D0-D7
		MOVEM.L	D0-D7,	(V_SCREENPOSX_DUP).W
		MOVEM.L	(V_FG_SCROLL_FLAGS).W,	D0-D1
		MOVEM.L	D0-D1,	(V_FG_SCROLL_FLAGS_DUP).W
		CMPI.B	#$60,	(V_HBLA_HREG+1).W
		BCC.S	DEMO_TIME
		MOVE.B	#1,	(F_DOUPDATESINHBLANK).W
		ADDQ.L	#4,	SP
		BRA.W	VBLA_EXIT

		INCLUDE		"SRC/DEMO_TIME.ASM"

VBLA_0A:	
		BSR.W	READJOYPADS
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9580,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$94019340,	(A5)
		MOVE.L	#$96FC9500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7800,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$940193C0,	(A5)
		MOVE.L	#$96E69500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7C00,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		BSR.W	NULLSUB_3
		TST.B	(F_SONFRAMECHG).W
		BEQ.S	VB0A_NOCHG
		LEA		($C00004).L,	A5
		MOVE.L	#$94019370,	(A5)
		MOVE.L	#$96E49500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7000,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		MOVE.B	#0,	(F_SONFRAMECHG).W

	VB0A_NOCHG:	
		TST.W	(V_DEMOLENGTH).W
		BEQ.W	VB0A_END
		SUBQ.W	#1,	(V_DEMOLENGTH).W

	VB0A_END:	
		RTS
		
VBLA_0C:	
		BSR.W	READJOYPADS
		TST.B	(F_WTR_STATE).W
		BNE.S	VB0C_WATERABOVE
		LEA		($C00004).l,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9580,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		BRA.S	VB0C_WATERBELOW
		
	VB0C_WATERABOVE:
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9540,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		
	VB0C_WATERBELOW:
		MOVE.W	(V_HBLA_HREG).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$940193C0,	(A5)
		MOVE.L	#$96E69500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7C00,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$94019340,	(A5)
		MOVE.L	#$96FC9500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7800,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		TST.B	(F_SONFRAMECHG).W
		BEQ.S	VB0C_NOCHG
		LEA		($C00004).L,	A5
		MOVE.L	#$94019370,	(A5)
		MOVE.L	#$96E49500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7000,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		MOVE.B	#0,	(F_SONFRAMECHG).W

	VB0C_NOCHG:
		MOVEM.L	(V_SCREENPOSX).W,	D0-D7
		MOVEM.L	D0-D7,	(V_SCREENPOSX_DUP).W
		MOVEM.L	(V_FG_SCROLL_FLAGS).W,	D0-D1
		MOVEM.L	D0-D1,	(V_FG_SCROLL_FLAGS_DUP).W
		BSR.W	SUB_6A32
		JSR		SUB_1C55E
		JSR		SUB_1CBD6
		BSR.W	SUB_1862
		RTS

VBLA_0E:	
		BSR.W	SUB_12A8
		ADDQ.B	#1,	(V_MISC_VARIABLES).W
		MOVE.B	#$E,	(V_VBLA_ROUTINE).W
		RTS

VBLA_12:	
		BSR.W	SUB_12A8
		MOVE.W	(V_HBLA_HREG).W,	(A5)
		BRA.W	SUB_1862

VBLA_16:
		BSR.W	READJOYPADS
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9580,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$94019340,	(A5)
		MOVE.L	#$96FC9500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7800,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$940193C0,	(A5)
		MOVE.L	#$96E69500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7C00,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		TST.B	(F_SONFRAMECHG).W
		BEQ.S	VB16_NOCHG
		LEA		($C00004).L,	A5
		MOVE.L	#$94019370,	(A5)
		MOVE.L	#$96E49500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7000,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		MOVE.B	#0,	(F_SONFRAMECHG).W

	VB16_NOCHG:
		TST.W	(V_DEMOLENGTH).W
		BEQ.W	VB16_END
		SUBQ.W	#1,	(V_DEMOLENGTH).W

	VB16_END:
		RTS

SUB_12A8:
		BSR.W	READJOYPADS
		TST.B	(F_WTR_STATE).W
		BNE.S	LOC_12D8
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9580,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		BRA.S	LOC_12FC

	LOC_12D8:
		LEA		($C00004).L,	A5
		MOVE.L	#$94009340,	(A5)
		MOVE.L	#$96FD9540,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$C000,	(A5)
		MOVE.W	#$80,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)

	LOC_12FC:
		LEA		($C00004).L,	A5
		MOVE.L	#$94019340,	(A5)
		MOVE.L	#$96FC9500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7800,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		LEA		($C00004).L,	A5
		MOVE.L	#$940193C0,	(A5)
		MOVE.L	#$96E69500,	(A5)
		MOVE.W	#$977F,	(A5)
		MOVE.W	#$7C00,	(A5)
		MOVE.W	#$83,	(V_VDP_BUFFER2).W
		MOVE.W	(V_VDP_BUFFER2).W,	(A5)
		RTS

VBLA_1A:
		BSR.W	SUB_12A8
		BSR.W	LOADTILESASYOUMOVE_BGONLY
		JSR		SUB_1DDDC
		BSR.W	SUB_1862
		TST.W	(V_DEMOLENGTH).W
		BEQ.W	VB1A_END
		SUBQ.W	#1,	(V_DEMOLENGTH).W
		
	VB1A_END:
		RTS