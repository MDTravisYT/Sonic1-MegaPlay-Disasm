ENTRYPOINT:
		TST.L	(Z80_PORT_1_CONTROL).L
		BNE.S	PORTA_OK
		TST.W	(Z80_EXPANSION_CONTROL).L
		
	PORTA_OK:
		BNE.S	SKIPSETUP
		LEA		SETUPVALUES(PC),A5
		MOVEM.W	(A5)+,	D5-D7
		MOVEM.L	(A5)+,	A0-A4
		MOVE.B	-$10FF(A1),	D0
		ANDI.B	#$F,	D0
		BEQ.S	SKIPSECURITY
		MOVE.L	#'SEGA',	$2F00(A1)
		
	SKIPSECURITY:
		MOVE.W	(A4),	D0
		MOVEQ	#0,	D0
		MOVEA.L	D0,	A6
		MOVE.L	A6,	USP
		MOVEQ	#$17,	D1
		
	VDPINITLOOP:
		MOVE.B	(A5)+,	D5
		MOVE.W	D5,	(A4)
		ADD.W	D7,	D5
		DBF		D1,	VDPINITLOOP
		MOVE.L	(A5)+,	(A4)
		MOVE.W	D0,	(A3)
		MOVE.W	D7,	(A1)
		MOVE.W	D7,	(A2)
		
	WAITFORZ80:
		BTST	D0,	(A1)
		BNE.S	WAITFORZ80
		MOVEQ	#$25,	D2
	
	Z80INITLOOP:
		MOVE.B	(A5)+,(A0)+
		DBF		D2,	Z80INITLOOP
		MOVE.W	D0,	(A2)
		MOVE.W	D0,	(A1)
		MOVE.W	D7,	(A2)
		
	CLRRAMLOOP:
		MOVE.L	D0,	-(A6)
		DBF		D6,	CLRRAMLOOP
		MOVE.L	(A5)+,	(A4)
		MOVE.L	(A5)+,	(A4)
		MOVEQ	#$1F,	D3
		
	CLRCRAMLOOP:
		MOVE.L	D0,	(A3)
		DBF		D3,	CLRCRAMLOOP
		MOVE.L	(A5)+,	(A4)
		MOVEQ	#$13,	D4
	
	CLRVSRAMLOOP:
		MOVE.L	D0,(A3)
		DBF		D4,	CLRVSRAMLOOP
		MOVEQ	#3,	D5
	
	PSGINITLOOP:
		MOVE.B	(A5)+,$11(A3)
		DBF		D5,	PSGINITLOOP
		MOVE.W	D0,	(A2)
		MOVEM.L	(A6),	D0-D7/A0-A6
		MOVE	#$2700,	SR
		
	SKIPSETUP:
		BRA.S	GAMEPROGRAM
		
;	===========================================================
		
	SETUPVALUES:
		DC.L	$80003FFF,$010000A0,$000000A1,$110000A1
		DC.L	$120000C0,$000000C0,$00040414,$303C076C
		DC.L	$00000000,$FF008137,$00010100,$00FFFF00
		DC.L	$00804000,$0080AF01,$D91F1127,$00212600
		DC.L	$F977EDB0,$DDE1FDE1,$ED47ED4F,$D1E1F108
		DC.L	$D9C1D1E1,$F1F9F3ED,$5636E9E9,$81048F02
		DC.L	$C0000000,$40000010,$9FBFDFFF
		
;	===========================================================
		
	GAMEPROGRAM:
		TST.W	(VDP_CONTROL_PORT).L
		LEA	(V_SYSTEMSTACK).W,	A6
		MOVEQ	#0,	D7
		MOVE.W	#$7F,	D6
		
	GP_CLEARRAM:
		MOVE.L	D7,	(A6)+
		DBF		D6,GP_CLEARRAM
		MOVE.B	(Z80_VERSION).L,	D0
		ANDI.B	#$C0,	D0
		MOVE.B	D0,	(V_MEGADRIVE).W
		LEA		(V_256X256).L,	A6
		MOVEQ	#0,	D7
		MOVE.W	#$3FFF,	D6
		
	GP_CLEARRAM_B:
		MOVE.L	D7,	(A6)+
		DBF		D6,	GP_CLEARRAM_B
		MOVE.B	#$80,	D0
		MOVE.B	D0,	(V_MEGADRIVE).W
		BSR.W	VDPSETUPGAME
		BSR.W	DACDRIVERLOAD
		BSR.W	JOYPADINIT
		BSR.W	SUB_3BC
		JSR		SUB_1E35E
		BSR.W	SUB_311C
		MOVE.B	#0,	(V_GAMEMODE).W
		
	MAINGAMELOOP:
		MOVE.B	(V_GAMEMODE).W,	D0
		ANDI.W	#$3C,	D0
		JSR		GAMEMODEARRAY(PC,D0.W)
		BRA.S	MAINGAMELOOP
